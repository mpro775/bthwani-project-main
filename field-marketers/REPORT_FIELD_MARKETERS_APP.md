# تقرير تطبيق المسوقين الميدانيين (bThwani Marketers)

**الإصدار:** 1.0.1  
**اسم التطبيق:** bThwani Marketers  
**العميل:** تسليم للعميل — وثيقة توضيحية لجميع العمليات والشاشات وما تم برمجته.

---

## محتويات التقرير

1. [نظرة عامة على التطبيق](#1-نظرة-عامة-على-التطبيق)
2. [هيكل التنقل](#2-هيكل-التنقل-navigation)
3. [الشاشات والعمليات المُبرمجة](#3-الشاشات-والعمليات-المُبرمجة)
4. [الخدمات والبنى التحتية](#4-الخدمات-والبنى-التحتية)
5. [واجهات الباك إند المستخدمة](#5-واجهات-الباك-إند-المستخدمة-ملخص)
6. [الأمان والصلاحيات](#6-الأمان-والصلاحيات)
7. [التقنيات المستخدمة](#7-التقنيات-المستخدمة)
8. [ملخص ما تم تسليمه للعميل](#8-ملخص-ما-تم-تسليمه-للعميل)

---

## 1. نظرة عامة على التطبيق

تطبيق **المسوقين الميدانيين** مخصّص لمسوقي بثواني في الميدان، ويمكّنهم من:

- تسجيل الدخول بحساب مسوق (بريد + كلمة مرور).
- عرض لوحة تحكم بأدائهم وإحصائياتهم.
- إدارة **طلبات الانضمام** (تسجيل متاجر/تجار جدد).
- إضافة متجر جديد عبر معالج خطوات (Wizard) مع خريطة وفئات.
- عرض الملف الشخصي وتعديله، وتسجيل الخروج وطلب حذف الحساب.

التطبيق مبني بـ **React Native (Expo)** ويتصل بباك إند **NestJS** عبر واجهات REST.

---

## 2. هيكل التنقل (Navigation)

| المستوى | الشاشة | الوصف |
|--------|--------|--------|
| **الجذر** | تحميل أولي | التحقق من وجود توكن (جلسة مسوق). |
| **بدون تسجيل** | Auth | مسار واحد: شاشة تسجيل الدخول. |
| **بعد تسجيل الدخول** | Main (تبويبات سفلية) | 4 تبويبات: الرئيسية، الطلبات، متجر جديد، حسابي. |

### 2.1 التبويبات الرئيسية بعد الدخول

1. **الرئيسية (Dashboard)** — لوحة التحكم.
2. **الطلبات (Onboarding)** — قائمة طلبات الانضمام + تفاصيل طلب.
3. **متجر جديد (OnboardingNew)** — معالج إضافة متجر (خطوات متعددة).
4. **حسابي (Profile)** — الملف الشخصي، إعدادات، تسجيل خروج، طلب حذف الحساب.

---

## 3. الشاشات والعمليات المُبرمجة

### 3.1 المصادقة (Auth)

| الشاشة | الملف | ما تم برمجته |
|--------|-------|----------------|
| **تسجيل الدخول** | `screens/auth/LoginScreen.tsx` | نموذج بريد إلكتروني + كلمة مرور، التحقق من صحة الحقول (بريد صحيح، كلمة مرور 6 أحرف على الأقل)، استدعاء `POST /auth/marketer-login`، حفظ التوكن وحالة المستخدم، الانتقال للوحة الرئيسية عند النجاح، وعرض رسالة خطأ من الخادم عند الفشل. |

**ملاحظة:** المسوق يُنشأ من لوحة تحكم الأدمن ويُعطى بريداً وكلمة مرور؛ يدخل بهما من التطبيق.

---

### 3.2 الرئيسية (لوحة التحكم)

| الشاشة | الملف | ما تم برمجته |
|--------|-------|----------------|
| **لوحة التحكم** | `screens/home/DashboardScreen.tsx` | ترحيب بالمسوق، بطاقات إحصائيات: **الطلبات المرسلة، المعتمدة، نسبة الاعتماد**، و**العمولة المستحقة، المدفوعة، في الانتظار**. رسم بياني شهري (أداء الطلبات) باستخدام Victory. سحب للتحديث (Pull to refresh). استدعاء `GET /marketer/overview`. أزرار سريعة: "متجر جديد" و "طلباتي". |

---

### 3.3 طلبات الانضمام (Onboarding)

| الشاشة | الملف | ما تم برمجته |
|--------|-------|----------------|
| **قائمة الطلبات** | `screens/onboarding/OnboardingListScreen.tsx` | قائمة (FlatList) بطلبات الانضمام الخاصة بالمسوق. كل عنصر: اسم المتجر، العنوان، حالة (المتجر مفعّل / تاجر نشط / غير مفعّل)، رقم معرف، تاريخ. النقر يفتح تفاصيل الطلب. ترقيم (Pagination) وتحميل المزيد، سحب للتحديث. استدعاء `GET /onboarding/my` مع page, limit, status. |
| **تفاصيل الطلب** | `screens/onboarding/OnboardingDetailScreen.tsx` | عرض تفاصيل طلب واحد: اسم المتجر، العنوان، الحالة (مسودة / مرفوع / يحتاج تعديل / معتمد / مرفوض). زر "رفع الطلب" للمسودات. استدعاء `GET /onboarding/:id` و `POST /onboarding/:id/submit`. |
| **معالج إضافة متجر (متجر جديد)** | `screens/onboarding/OnboardingWizardScreen.tsx` | معالج خطوات (5 خطوات): **1)** بيانات المتجر (اسم، عنوان، فئة، خريطة لاختيار الموقع، "استخدم موقعي الحالي"). **2)** بيانات صاحب المتجر (اسم، هاتف، بريد، كلمة مرور). **3)** المشاركون (اختياري). **4)** صور ومرفقات. **5)** مراجعة ثم الإرسال. اختيار الفئة من قائمة (مع بحث) من `GET /delivery/categories`. رفع الصور عبر خدمة الرفع. الإرسال النهائي: `POST /onboarding/quick-onboard` مع (phone, storeName, location, ownerName, type). |

---

### 3.4 حسابي (الملف الشخصي والإعدادات)

| الشاشة | الملف | ما تم برمجته |
|--------|-------|----------------|
| **حسابي** | `screens/account/ProfileScreen.tsx` | عرض الاسم والبريد، صورة رمزية بأول حرف من الاسم. عناصر قائمة: نظام الإحالة، إعدادات الإشعارات، المساعدة والدعم، طلب حذف الحساب. جلب الملف: `GET /marketer/profile`. تحديث الملف: `PATCH /marketer/profile`. تسجيل الخروج (مسح التوكن والخروج من التطبيق). نافذة تأكيد لطلب حذف الحساب مع استدعاء `POST /auth/delete-account/request`. |

---

### 3.5 شاشات إضافية مُبرمجة (جاهزة للربط في التنقل)

هذه الشاشات مبرمجة ومتكاملة مع الـ API ويمكن ربطها من قائمة "حسابي" أو من لوحة التحكم عند الحاجة:

| الشاشة | الملف | الوظيفة والـ API |
|--------|-------|-------------------|
| **قائمة المتاجر** | `screens/stores/StoresListScreen.tsx` | قائمة المتاجر المرتبطة بالمسوق. استدعاء `GET /marketer/stores/my`. النقر يفتح تفاصيل المتجر. |
| **تفاصيل المتجر** | `screens/stores/StoreDetailsScreen.tsx` | تفاصيل متجر واحد. استدعاء `GET /marketer/stores/:id`. |
| **عمولاتي** | `screens/account/CommissionsScreen.tsx` | قائمة العمولات مع فلتر (الكل / معلقة / مدفوعة)، وإحصائيات (إجمالي، معلق، مدفوع). استدعاء `GET /marketer/commissions/my` و `GET /marketer/commissions/statistics`. |
| **أرباحي** | `screens/account/EarningsScreen.tsx` | إجمالي الأرباح، عدد الطلبات، متوسط لكل طلب. اختيار فترة (أسبوع / شهر / سنة). رسوم بيانية (Pie/Bar) للتفصيل. استدعاء `GET /marketer/earnings` و `GET /marketer/earnings/breakdown`. |
| **الإشعارات** | `screens/account/NotificationsScreen.tsx` | قائمة الإشعارات، تحديد كمقروء. استدعاء `GET /marketer/notifications` و `PATCH /marketer/notifications/:id/read`. |
| **نظام الإحالة** | `screens/account/ReferralScreen.tsx` | إنشاء/جلب كود إحالة، رابط مشاركة، نسخ للحافظة، مشاركة. إحصائيات (نقرات، تسجيلات، تحويلات). استدعاء `POST /marketer/referrals/generate-code` و `GET /marketer/referrals/statistics`. |

---

## 4. الخدمات والبنى التحتية

| المكون | الملف/المسار | الوظيفة |
|--------|---------------|---------|
| **المصادقة والسياق** | `context/AuthContext.tsx` | حفظ التوكن والمستخدم، التحقق من الجلسة عند البدء عبر `GET /auth/me`، تسجيل الدخول والخروج، ربط Expo Push Token عبر `POST /auth/push-token`. |
| **عميل API** | `api/client.ts` | Axios مع baseURL من الإعدادات، إرفاق Bearer token من SecureStore، معالجة أخطاء موحّدة. |
| **مسارات API** | `api/routes.ts` | تعريف جميع الـ endpoints (Auth, Profile, Onboarding, Stores, Commissions, Earnings, Notifications, Referrals, إلخ). |
| **طلبات الانضمام (Hook)** | `hooks/useOnboarding.ts` | listMy, getOne, createDraft, updateDraft, submitDraft مع ترقيم وأخطاء. |
| **الموقع** | `services/location.ts` | طلب صلاحية الموقع والحصول على الإحداثيات (لخريطة المتجر). |
| **الرفع** | `services/upload.ts` / `uploadFileToCloudinary.ts` | رفع الملفات/الصور المستخدمة في معالج إضافة المتجر. |
| **الإشعارات** | `services/push.ts` | تسجيل Expo Push Token للإشعارات. |
| **خريطة اختيار الموقع** | `components/MapPicker.tsx` | مكوّن لاختيار إحداثيات المتجر على الخريطة. |
| **خط وألوان الهوية** | `constants/colors.ts` + خط Cairo | ألوان موحّدة وخط عربي (Cairo) في الواجهات. |

---

## 5. واجهات الباك إند المستخدمة (ملخص)

| المجموعة | أمثلة مسارات | الاستخدام في التطبيق |
|----------|---------------|------------------------|
| **المصادقة** | `POST /auth/marketer-login`, `GET /auth/me`, `POST /auth/push-token` | تسجيل الدخول، التحقق من الجلسة، ربط الإشعارات. |
| **الملف الشخصي** | `GET /marketer/profile`, `PATCH /marketer/profile` | عرض وتحديث بيانات المسوق. |
| **الانضمام** | `GET /onboarding/my`, `GET /onboarding/:id`, `PATCH /onboarding/:id`, `POST /onboarding/:id/submit`, `POST /onboarding/quick-onboard` | قائمة الطلبات، التفاصيل، التحديث، الرفع، التسجيل السريع. |
| **المتاجر** | `GET /marketer/stores/my`, `GET /marketer/stores/:id` | قائمة المتاجر وتفاصيل المتجر. |
| **العمولات** | `GET /marketer/commissions/my`, `GET /marketer/commissions/statistics` | عمولاتي وإحصائيات. |
| **الأرباح** | `GET /marketer/earnings`, `GET /marketer/earnings/breakdown` | أرباحي وتفصيل. |
| **الإشعارات** | `GET /marketer/notifications`, `PATCH /marketer/notifications/:id/read` | قائمة الإشعارات وتحديد مقروء. |
| **الإحالة** | `POST /marketer/referrals/generate-code`, `GET /marketer/referrals/statistics` | كود الإحالة وإحصائيات. |
| **لوحة التحكم** | `GET /marketer/overview` | إحصائيات لوحة التحكم. |
| **فئات المتاجر** | `GET /delivery/categories` | قائمة الفئات في معالج إضافة المتجر. |

---

## 6. الأمان والصلاحيات

- تسجيل الدخول بـ **بريد المسوق + كلمة المرور** (المسوق يُنشأ من لوحة الأدمن).
- **JWT خاص بالمسوق** (Marketer JWT) يُرسل في هيدر `Authorization: Bearer <token>`.
- حفظ التوكن في **Expo SecureStore** (لا يُخزّن في تخزين عادي).
- طلبات الـ API تُرفق تلقائياً بالتوكن عبر Interceptor.

---

## 7. التقنيات المستخدمة

- **React Native** مع **Expo**.
- **React Navigation** (Stack + Bottom Tabs).
- **Axios** للاتصال بالـ API.
- **Expo SecureStore** لحفظ التوكن.
- **Expo Notifications** للإشعارات.
- **Expo Image Picker** لاختيار الصور.
- **Victory (victory-native)** للرسوم البيانية.
- **Expo Linear Gradient** للخلفيات المتدرجة.
- خط **Cairo** للواجهة العربية.

---

## 8. ملخص ما تم تسليمه للعميل

- تطبيق جوال كامل لمسوقي بثواني الميدانيين.
- تسجيل دخول آمن (بريد + كلمة مرور) مع التحقق من الجلسة.
- لوحة تحكم بإحصائيات الطلبات والعمولات ورسم بياني شهري.
- إدارة طلبات الانضمام: قائمة، تفاصيل، رفع مسودات.
- معالج إضافة متجر جديد (5 خطوات) مع خريطة، فئات، صور، وبيانات المالك.
- شاشة حسابي: عرض وتحديث الملف، تسجيل خروج، طلب حذف الحساب.
- شاشات جاهزة للعمولات، الأرباح، الإشعارات، الإحالة، والمتاجر (يمكن ربطها من القوائم لاحقاً).
- تكامل كامل مع باك إند NestJS (مسارات موثّقة ومستخدمة).
- واجهة عربية موحّدة (ألوان وخط Cairo).

---

*آخر تحديث: بناءً على مراجعة كود التطبيق في المشروع.*
