# ููุฎุต ุฅููุงู ุงููุฑุญูุฉ 6 - ุฅููุงู ุงูุนูููุงุช (ุงูููุจููุงุช ูุงูุงุดุชุฑุงูุงุช)

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุฑุจุท ุงูููุจููุงุช ูุน Finance Module

**ุงููููุงุช ุงูููุญุฏูุซุฉ:**
- `backend-nest/src/modules/wallet/wallet.module.ts` - ุฅุถุงูุฉ FinanceModule
- `backend-nest/src/modules/wallet/wallet.service.ts` - ุฅุถุงูุฉ ุฏูุงู ุงูููุจููุงุช
- `backend-nest/src/modules/wallet/v2-wallet.controller.ts` - ุชุญุฏูุซ endpoints

**ุงูุฏูุงู ุงูููุถุงูุฉ:**
- โ `applyCoupon()` - ุชุทุจูู ููุจูู ุนูู ุงููุญูุธุฉ
  - ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูููุจูู ุนุจุฑ `CouponService.validate()`
  - ุชุทุจูู ุงูููุจูู (ุฒูุงุฏุฉ ุงูุนุฏุงุฏ) ุนุจุฑ `CouponService.apply()`
  - ุฅุถุงูุฉ ุงููุจูุบ ุฅูู ุงููุญูุธุฉ ูุฅูุฏุงุน (method: 'reward')
  - ุญูุธ ูุนูููุงุช ุงูููุจูู ูู meta

- โ `validateCoupon()` - ุงูุชุญูู ูู ุตูุงุญูุฉ ููุจูู
  - ุงุณุชุฎุฏุงู `CouponService.validate()` ููุชุญูู
  - ุฅุฑุฌุงุน ูุนูููุงุช ุงูุฎุตู ูุงูุตูุงุญูุฉ

- โ `getMyCoupons()` - ุงูุญุตูู ุนูู ููุจููุงุช ุงููุณุชุฎุฏู ุงููุชุงุญุฉ
  - ุฌูุจ ุฌููุน ุงูููุจููุงุช ุงููุดุทุฉ
  - ููุชุฑุฉ ุงูููุจููุงุช ุงููุชุงุญุฉ (ุชุงุฑูุฎุ ุงุณุชุฎุฏุงู)

- โ `getCouponsHistory()` - ุณุฌู ุงุณุชุฎุฏุงู ุงูููุจููุงุช
  - ุงูุจุญุซ ุนู ุงููุนุงููุงุช ุงููุชุนููุฉ ุจุงูููุจููุงุช
  - ุฅุฑุฌุงุน ุณุฌู ุงูุงุณุชุฎุฏุงูุงุช

### 2. ุฑุจุท ุงูุงุดุชุฑุงูุงุช ูุน Content Module

**ุงููููุงุช ุงูููุญุฏูุซุฉ:**
- `backend-nest/src/modules/wallet/wallet.module.ts` - ุฅุถุงูุฉ ContentModule
- `backend-nest/src/modules/wallet/wallet.service.ts` - ุฅุถุงูุฉ ุฏูุงู ุงูุงุดุชุฑุงูุงุช
- `backend-nest/src/modules/wallet/v2-wallet.controller.ts` - ุชุญุฏูุซ endpoints

**ุงูุฏูุงู ุงูููุถุงูุฉ:**
- โ `subscribe()` - ุงูุงุดุชุฑุงู ูู ุฎุทุฉ
  - ุงูุจุญุซ ุนู ุงูุฎุทุฉ ุนุจุฑ `ContentService.findAllSubscriptionPlans()`
  - ุงูุชุญูู ูู ุงูุฑุตูุฏ ุงููุงูู
  - ุฎุตู ุงููุจูุบ ูู ุงููุญูุธุฉ (method: 'payment')
  - ุฅูุดุงุก ุงูุงุดุชุฑุงู ุนุจุฑ `ContentService.subscribe()`
  - ุฏุนู autoRenew

- โ `getMySubscriptions()` - ุงูุญุตูู ุนูู ุงุดุชุฑุงูุงุช ุงููุณุชุฎุฏู
  - ุงุณุชุฎุฏุงู `ContentService.getMySubscription()`
  - ุฅุฑุฌุงุน ุงูุงุดุชุฑุงูุงุช ุงููุดุทุฉ

- โ `cancelSubscription()` - ุฅูุบุงุก ุงุดุชุฑุงู
  - ุงูุชุญูู ูู ุฃู ุงูุงุดุชุฑุงู ูุฎุต ุงููุณุชุฎุฏู
  - ุฅูุบุงุก ุงูุงุดุชุฑุงู ุนุจุฑ `ContentService.cancelSubscription()`
  - ุฏุนู ุณุจุจ ุงูุฅูุบุงุก

---

## ๐ ุงููููุงุช ุงูููุญุฏูุซุฉ

1. **`backend-nest/src/modules/wallet/wallet.module.ts`**
   - ุฅุถุงูุฉ `FinanceModule` ู `ContentModule` ุฅูู imports
   - ุงุณุชุฎุฏุงู `forwardRef()` ูุชุฌูุจ circular dependencies

2. **`backend-nest/src/modules/wallet/wallet.service.ts`**
   - ุฅุถุงูุฉ `CouponService` ู `ContentService` ุฅูู constructor
   - ุฅุถุงูุฉ 7 ุฏูุงู ุฌุฏูุฏุฉ:
     - `applyCoupon()`
     - `validateCoupon()`
     - `getMyCoupons()`
     - `getCouponsHistory()`
     - `subscribe()`
     - `getMySubscriptions()`
     - `cancelSubscription()`

3. **`backend-nest/src/modules/wallet/v2-wallet.controller.ts`**
   - ุชุญุฏูุซ 7 endpoints ูุงุณุชุฎุฏุงู `walletService`:
     - `POST /v2/wallet/coupons/apply`
     - `POST /v2/wallet/coupons/validate`
     - `GET /v2/wallet/coupons/my`
     - `GET /v2/wallet/coupons/history`
     - `POST /v2/wallet/subscriptions/subscribe`
     - `GET /v2/wallet/subscriptions/my`
     - `PATCH /v2/wallet/subscriptions/:id/cancel`

---

## ๐ ุงูุชูุงูู ูุน Modules ุงูุฃุฎุฑู

### Finance Module:
- โ ุงุณุชุฎุฏุงู `CouponService.validate()` ููุชุญูู ูู ุงูููุจููุงุช
- โ ุงุณุชุฎุฏุงู `CouponService.apply()` ูุชุทุจูู ุงูููุจูู
- โ ุงุณุชุฎุฏุงู `CouponService.findAll()` ูุฌูุจ ุงูููุจููุงุช

### Content Module:
- โ ุงุณุชุฎุฏุงู `ContentService.findAllSubscriptionPlans()` ูุฌูุจ ุงูุฎุทุท
- โ ุงุณุชุฎุฏุงู `ContentService.subscribe()` ูุฅูุดุงุก ุงูุงุดุชุฑุงู
- โ ุงุณุชุฎุฏุงู `ContentService.getMySubscription()` ูุฌูุจ ุงูุงุดุชุฑุงูุงุช
- โ ุงุณุชุฎุฏุงู `ContentService.cancelSubscription()` ูุฅูุบุงุก ุงูุงุดุชุฑุงู

---

## ๐ฐ ูุนุงูุฌุฉ ุงููุฏููุนุงุช

### ุงูููุจููุงุช:
- ุนูุฏ ุชุทุจูู ููุจูู ุตุงูุญุ ูุชู ุฅุถุงูุฉ ูุจูุบ ุงูุฎุตู ุฅูู ุงููุญูุธุฉ
- ููุน ุงููุนุงููุฉ: `credit`
- ุทุฑููุฉ ุงูุฏูุน: `reward`
- ูุชู ุญูุธ ูุนูููุงุช ุงูููุจูู ูู `meta`:
  ```json
  {
    "couponCode": "SAVE10",
    "couponId": "..."
  }
  ```

### ุงูุงุดุชุฑุงูุงุช:
- ุนูุฏ ุงูุงุดุชุฑุงู ูู ุฎุทุฉุ ูุชู ุฎุตู ุงููุจูุบ ูู ุงููุญูุธุฉ
- ููุน ุงููุนุงููุฉ: `debit`
- ุทุฑููุฉ ุงูุฏูุน: `payment`
- ูุชู ุญูุธ ูุนูููุงุช ุงูุฎุทุฉ ูู `meta`:
  ```json
  {
    "planId": "...",
    "planCode": "PREMIUM"
  }
  ```

---

## ๐ฏ ุงููููุฒุงุช

### ุงูููุจููุงุช:
- โ ุงูุชุญูู ุงูุดุงูู ูู ุตูุงุญูุฉ ุงูููุจูู
- โ ุญุณุงุจ ุงูุฎุตู ุชููุงุฆูุงู
- โ ุฅุถุงูุฉ ุงููุจูุบ ุฅูู ุงููุญูุธุฉ ุชููุงุฆูุงู
- โ ุชุชุจุน ุงุณุชุฎุฏุงู ุงูููุจููุงุช
- โ ุณุฌู ูุงูู ููุงุณุชุฎุฏุงูุงุช

### ุงูุงุดุชุฑุงูุงุช:
- โ ุงูุชุญูู ูู ุงูุฑุตูุฏ ูุจู ุงูุงุดุชุฑุงู
- โ ุฎุตู ุชููุงุฆู ูู ุงููุญูุธุฉ
- โ ุฏุนู autoRenew
- โ ุฅูุบุงุก ุงูุงุดุชุฑุงู ูุน ุณุจุจ
- โ ุชุชุจุน ุงููุนุงููุงุช

---

## ๐ ุงูุฃูุงู

- โ ุฌููุน endpoints ูุญููุฉ ุจู `@Auth(AuthType.FIREBASE)`
- โ ุงูุชุญูู ูู ุฃู ุงูุงุดุชุฑุงู ูุฎุต ุงููุณุชุฎุฏู ูุจู ุงูุฅูุบุงุก
- โ ุงูุชุญูู ูู ุงูุฑุตูุฏ ูุจู ุงูุงุดุชุฑุงู
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุดุงููุฉ

---

## ๐ ููุงุญุธุงุช

1. **Circular Dependencies**: ุชู ุงุณุชุฎุฏุงู `forwardRef()` ูุชุฌูุจ ูุดุงูู ุงูุชุจุนูุงุช ุงูุฏุงุฆุฑูุฉ ุจูู WalletModule ู FinanceModule/ContentModule

2. **Error Handling**: ุฌููุน ุงูุฏูุงู ุชุญุชูู ุนูู ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ ูุน ุฑุณุงุฆู ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ

3. **Transaction Safety**: ุงุณุชุฎุฏุงู `debit()` ู `credit()` ุงูููุฌูุฏุฉ ูู WalletService ูุถูุงู ุณูุงูุฉ ุงููุนุงููุงุช

4. **Meta Data**: ุญูุธ ูุนูููุงุช ุฅุถุงููุฉ ูู `meta` ููู ูุนุงููุฉ ูุชุณููู ุงูุชุชุจุน ูุงูุชุญููู

---

## โ ุงูุญุงูุฉ

ุฌููุน ุงูููุงู ูู ุงููุฑุญูุฉ 6 ุชู ุฅููุงููุง ุจูุฌุงุญ! โ

**ุขุฎุฑ ุชุญุฏูุซ**: 2026-01-23

---

## ๐ ููุฎุต ุงูุชูุฏู ุงููุงูู

- โ ุงููุฑุญูุฉ 1: Backend Endpoints โ ููุชููุฉ
- โ ุงููุฑุญูุฉ 2: ููุญุฉ ุงูุชุญูู โ ููุชููุฉ
- โ ุงููุฑุญูุฉ 3: ุชุทุจูู ุงููุณุชุฎุฏู โ ููุชููุฉ
- โ ุงููุฑุญูุฉ 4: ุชุทุจูู ุงูุณุงุฆู โ ููุชููุฉ
- โ ุงููุฑุญูุฉ 5: ุชูุงุฑูุฑ ูุฅุญุตุงุฆูุงุช โ ููุชููุฉ
- โ ุงููุฑุญูุฉ 6: ุฅููุงู ุงูุนูููุงุช โ ููุชููุฉ

**ุฌููุน ุงููุฑุงุญู ุงูุณุชุฉ ููุชููุฉ ุจูุฌุงุญ! ๐**
