# مقارنة خدمة معروف بمواصفات V6 – المفقودات والموجودات (FindMe)

هذا المستند يقارن ما ورد في **وثائق التسليم** (Full Handover Documents) لخدمة **V6 – Lost & Found (FindMe)** بما تم تنفيذه فعلياً في **خدمة معروف** عبر التطبيقات والويب ولوحة التحكم والباك إند.

---

## 1. نظرة عامة

| العنصر      | وثائق التسليم (V6 – FindMe)                    | خدمة معروف المُنفذة                                  |
| ----------- | ---------------------------------------------- | ---------------------------------------------------- |
| **الاسم**   | Lost & Found / FindMe                          | معروف (Maarouf)                                      |
| **الهدف**   | استرداد المفقودات (هواتف، حيوانات، هويات، إلخ) | ✅ مطابق                                             |
| **المنصات** | تطبيق، ويب، لوحة تحكم، تطبيق السائقين          | ✅ app-user, bthwani-web, admin-dashboard, rider-app |

---

## 2. مواصفات قاعدة البيانات ومقارنتها

### 2.1 جدول lost_found (المُقابل: Maarouf)

| الحقل في الوثائق    | الحقل في معروف                                                         | الحالة                          |
| ------------------- | ---------------------------------------------------------------------- | ------------------------------- |
| `id`                | `_id`                                                                  | ✅ مطابق                        |
| `type (lost/found)` | `kind` (MaaroufKind: lost/found)                                       | ✅ مطابق                        |
| `user_id`           | `ownerId`                                                              | ✅ مطابق                        |
| `category`          | `category` (MaaroufCategory: phone, pet, id, wallet, keys, bag, other) | ✅ مطابق                        |
| `description`       | `description`                                                          | ✅ مطابق                        |
| `location`          | `location` (GeoJSON Point مع فهرس 2dsphere)                            | ✅ مطابق                        |
| `reward`            | `reward`                                                               | ✅ مطابق                        |
| `status`            | `status` (draft, pending, confirmed, completed, cancelled, expired)    | ✅ مطابق                        |
| `media_id[]`        | `mediaUrls` (مصفوفة روابط صور)                                         | ✅ مُنفذ (استخدام URLs بدل IDs) |
| `delivery_id`       | `deliveryId`                                                           | ✅ مطابق                        |
| `matched_to_id`     | `matchedToId`                                                          | ✅ مطابق                        |
| —                   | `title`                                                                | ✅ إضافة لدعم العربية           |
| —                   | `tags`                                                                 | ✅ إضافة للبحث والتصنيف         |
| —                   | `metadata`                                                             | ✅ إضافة لبيانات مرنة           |
| —                   | `deliveryToggle`                                                       | ✅ مطابق للمواصفات              |
| —                   | `isAnonymous`                                                          | ✅ مطابق                        |
| —                   | `expiresAt`                                                            | ✅ مطابق                        |

### 2.2 جدول reward_holds

| الحقل في الوثائق | الحقل في معروف                       | الحالة                        |
| ---------------- | ------------------------------------ | ----------------------------- |
| `founder_id`     | `founderId`                          | ✅ مطابق                      |
| `claimer_id`     | `claimerId`                          | ✅ مطابق                      |
| `amount`         | `amount`                             | ✅ مطابق                      |
| `status`         | `status` (pending/released/refunded) | ✅ مطابق                      |
| `wallet_tx_id`   | `walletTxId`                         | ✅ مطابق                      |
| —                | `maaroufId`                          | ✅ مرجع للإعلان               |
| —                | `deliveryCode`                       | ✅ OTP/رمز استلام عند التسليم |

---

## 3. الميزات الأساسية (Core Features)

| الميزة في الوثائق   | الوصف                          | الحالة في معروف                                     |
| ------------------- | ------------------------------ | --------------------------------------------------- |
| **Lost/Found Post** | نشر مفقود أو موجود مع صورة     | ✅ مُنفذ                                            |
| **Optional Reward** | مكافأة اختيارية                | ✅ مُنفذ                                            |
| **Geo Location**    | موقع جغرافي (إحداثيات)         | ✅ مُنفذ (GeoJSON Point + 2dsphere)                 |
| **Delivery Toggle** | خيار التوصيل                   | ✅ مُنفذ                                            |
| **Category**        | تصنيف (Pets, Phones, IDs, إلخ) | ✅ مُنفذ (phone, pet, id, wallet, keys, bag, other) |
| **Media/Images**    | صور للمعلن                     | ✅ مُنفذ (mediaUrls)                                |

---

## 4. الميزات المتقدمة (Advanced Features)

| الميزة في الوثائق             | الوصف                        | الحالة في معروف                         |
| ----------------------------- | ---------------------------- | --------------------------------------- |
| **Anonymous Posting**         | نشر بدون رقم هاتف            | ✅ مُنفذ                                |
| **Reward via Escrow**         | حجز المكافأة في المحفظة      | ✅ مُنفذ (reward_holds + WalletService) |
| **Contactless Chat**          | محادثة بدون إظهار رقم الهاتف | ✅ مُنفذ (إخفاء phone عند isAnonymous)  |
| **Delivery Agent Assignment** | تعيين موصل للتوصيل           | ✅ مُنفذ (assign-delivery)              |
| **Proof of Return**           | تأكيد التسليم (OTP/PIN)      | ✅ مُنفذ (deliveryCode + verify-code)   |

---

## 5. الميزات الذكية (Smart Features)

| الميزة في الوثائق                    | الوصف                             | الحالة في معروف                                    |
| ------------------------------------ | --------------------------------- | -------------------------------------------------- |
| **Geo-Matching Alert**               | تنبيهات جغرافية لقرب الموقع       | ✅ مُنفذ (findMatches + فلتر near)                 |
| **Similar Item Detector (Image AI)** | مطابقة بالصورة                    | ❌ غير مُنفذ                                       |
| **Auto-expiry**                      | انتهاء تلقائي للإعلانات           | ✅ مُنفذ (Cron job + expiresAt)                    |
| **Category Auto-Fill from Photo**    | تعبئة التصنيف من الصورة           | ❌ غير مُنفذ                                       |
| **Real-Time Notifications Nearby**   | إشعارات فورية للمستخدمين القريبين | ⚠️ جزئي (Geo-Matching موجود، إشعارات تحتاج موديول) |

---

## 6. واجهات API – مقارنة Endpoints

| Endpoint في الوثائق              | Endpoint في معروف                                   | الحالة                 |
| -------------------------------- | --------------------------------------------------- | ---------------------- |
| `POST /lostfound/post`           | `POST /maarouf`                                     | ✅ مُنفذ               |
| `POST /lostfound/match`          | `POST /maarouf/match`                               | ✅ مُنفذ               |
| `POST /lostfound/reward/confirm` | `POST /maarouf/:id/reward-hold/:holdId/release`     | ✅ مُنفذ               |
| —                                | `POST /maarouf/:id/reward-hold`                     | ✅ حجز مكافأة          |
| —                                | `POST /maarouf/:id/reward-hold/:holdId/verify-code` | ✅ تحقق OTP وإطلاق     |
| —                                | `POST /maarouf/:id/reward-hold/:holdId/refund`      | ✅ استرداد             |
| —                                | `PATCH /maarouf/:id/link`                           | ✅ ربط يدوي lost↔found |
| —                                | `GET /maarouf?near=lat,lng&radius=km`               | ✅ فلتر جغرافي         |
| —                                | `POST /maarouf/:id/assign-delivery`                 | ✅ تعيين توصيل         |
| —                                | `POST /maarouf/upload`                              | ✅ رفع صور             |

---

## 7. الخدمات (Services) – مقارنة

| الخدمة في الوثائق           | الوصف                             | الحالة في معروف                        |
| --------------------------- | --------------------------------- | -------------------------------------- |
| **lost-found-post-service** | نشر وتصنيف العناصر                | ✅ MaaroufService                      |
| **match-service**           | مطابقة جغرافية + نصية             | ✅ findMatches (geo + category + tags) |
| **reward-service**          | Escrow hold/release               | ✅ RewardHoldService + WalletService   |
| **anon-chat-service**       | محادثة مجهولة                     | ✅ maarouf-chat + إخفاء phone          |
| **delivery-verify-service** | تأكيد إطلاق المكافأة بعد الاستلام | ✅ verifyCodeAndRelease                |

---

## 8. التطبيق (app-user)

| الميزة في الوثائق            | الحالة في معروف                     |
| ---------------------------- | ----------------------------------- |
| Post Lost Item               | ✅ MaaroufCreateScreen              |
| Post Found Item              | ✅ نفس الشاشة                       |
| Feed Lost/Found              | ✅ MaaroufListScreen                |
| Reward Toggle                | ✅ حقل مكافأة                       |
| Delivery Option              | ✅ deliveryToggle                   |
| Anon Chat                    | ✅ إخفاء رقم الهاتف عند isAnonymous |
| رفع الصور                    | ✅ مُنفذ                            |
| التصنيف (category)           | ✅ مُنفذ                            |
| الموقع الجغرافي              | ✅ مُنفذ (SelectLocationScreen)     |
| عرض الموقع على خريطة         | ✅ مُنفذ                            |
| فلتر حسب التصنيف و hasReward | ✅ مُنفذ                            |

---

## 9. الموقع (bthwani-web)

| الميزة في الوثائق          | الحالة في معروف              |
| -------------------------- | ---------------------------- |
| Post Lost/Found            | ✅ MaaroufForm               |
| عرض القائمة                | ✅ MaaroufList + MaaroufCard |
| عرض التفاصيل               | ✅ MaaroufDetails            |
| رفع الصور                  | ✅ مُنفذ                     |
| التصنيف والمكافأة          | ✅ مُنفذ                     |
| خريطة الموقع               | ✅ مُنفذ                     |
| فلاتر category و hasReward | ✅ MaaroufFilters            |

---

## 10. لوحة التحكم (admin-dashboard)

| الميزة في الوثائق         | الحالة في معروف                |
| ------------------------- | ------------------------------ |
| قائمة الإعلانات           | ✅ MaaroufListPage             |
| تفاصيل الإعلان            | ✅ MaaroufDetailsPage          |
| عمود الصورة               | ✅ مُنفذ                       |
| عمود التصنيف والمكافأة    | ✅ مُنفذ                       |
| فلتر category و hasReward | ✅ مُنفذ                       |
| عرض الموقع على خريطة      | ✅ مُنفذ                       |
| إدارة reward_holds        | ✅ مُنفذ (عرض + إطلاق/استرداد) |

---

## 11. تطبيق السائقين (rider-app)

| الميزة في الوثائق     | الحالة في معروف                                    |
| --------------------- | -------------------------------------------------- |
| عرض طلبات توصيل معروف | ✅ MaaroufDeliveriesScreen                         |
| تفاصيل التوصيل        | ✅ MaaroufDeliveryDetailsScreen                    |
| تأكيد الاستلام (OTP)  | ✅ مُنفذ (إدخال رمز الاستلام + إطلاق المكافأة)     |
| Accept Delivery       | ⚠️ assign-delivery موجود، يحتاج ربط بتدفق السائقين |

---

## 12. الخصوصية والأمان (Privacy)

| المتطلب في الوثائق             | الحالة في معروف                    |
| ------------------------------ | ---------------------------------- |
| نشر بدون رقم هاتف (anonymous)  | ✅ isAnonymous                     |
| إخفاء phone في populate        | ✅ مُنفذ في backend                |
| إخفاء زر الاتصال عند anonymous | ✅ مُنفذ في app-user و bthwani-web |
| Nickname بدل الاسم             | ✅ "مستخدم" في المحادثة            |
| Reward escrow حتى الت verify   | ✅ مُنفذ عبر WalletService         |

---

## 13. ملخص التنفيذ

### ✅ ما تم تنفيذه بنجاح

| الفئة               | الميزات                                                                            |
| ------------------- | ---------------------------------------------------------------------------------- |
| **Backend**         | Entity كاملة، reward_holds، Escrow، Match، Geo-Matching، Auto-expiry، OTP، رفع صور |
| **app-user**        | إنشاء/تعديل/تفاصيل/قائمة، صور، تصنيف، مكافأة، موقع، خريطة، anonymous، محادثة       |
| **bthwani-web**     | نفس الميزات الأساسية مع واجهة ويب                                                  |
| **admin-dashboard** | قائمة، تفاصيل، فلترة، خرائط، إدارة reward_holds                                    |
| **rider-app**       | قائمة توصيلات، تفاصيل، تأكيد استلام (OTP)                                          |

### ⚠️ ما قد يُحسّن لاحقاً

| الميزة                            | الوصف                                           |
| --------------------------------- | ----------------------------------------------- |
| **Image AI Matching**             | مطابقة الصور تلقائياً (Similar Item Detector)   |
| **Category Auto-Fill from Photo** | تعبئة التصنيف من الصورة                         |
| **Real-Time Geo Notifications**   | إشعارات فورية للمستخدمين القريبين عند نشر found |
| **FAB Integration**               | زر "Post Found Item" في FAB الرئيسي             |

### ❌ ما لم يُنفذ (غير حرج)

| الميزة                        | التقييم                        |
| ----------------------------- | ------------------------------ |
| Image Search (رفع صورة للبحث) | Phase 3 – يحتاج AI/ML          |
| E2E Encryption للـ Chat       | يُفترض أن يكون في chat-service |

---

## 14. الخلاصة

**خدمة معروف** تنفذ **معظم** متطلبات **V6 – Lost & Found (FindMe)** من وثائق التسليم:

- ✅ **Core:** نشر lost/found، صور، تصنيف، مكافأة، موقع، خيار التوصيل |
- ✅ **Advanced:** نشر مجهول، Escrow، محادثة، تعيين موصل، OTP |
- ✅ **Smart:** Geo-Matching، Auto-expiry، Match Service |
- ✅ **منصات:** app-user، bthwani-web، admin-dashboard، rider-app |

الفروقات الباقية هي أساساً في **Smart AI** (مطابقة الصور، تعبئة التصنيف من الصورة) وإشعارات جغرافية فورية، وهي ميزات متقدمة يمكن إضافتها في مراحل لاحقة.

---

_تم إعداد هذا المستند بناءً على:_

- _Full Handover Documents for bThwani Super App & Web Development, final to Mohammed .docx.md_
- _تنفيذ خدمة معروف في backend-nest، app-user، bthwani-web، admin-dashboard، rider-app_
